<html>
<head>
	<meta charset="utf-8"/>
	<title>Kakao 지도 시작하기</title>
</head>
<body>
<h2>Map View</h2>
	<div id="map" style="width:800px;height:500px;"></div>

    <div id="lat" style="display: none">
        {%for al in alcolshops%}
            {{ al.latitude }},
        {% endfor %}
    </div>
    <div id="lng" style="display: none">
        {%for al in alcolshops%}
            {{ al.longitude }},
        {% endfor %}
    </div>
    <div id="name" style="display: none">
        {%for al in alcolshops%}
            {{ al.name }},
        {% endfor %}
    </div>

<div>
    <form method="POST" action="{% url 'mapss:kakaomap' %}">
        {% csrf_token %}
        <p><label for="id_patner">patner:</label>
            <input type="checkbox" name="patner" id="id_patner"></p>
        <p><label for="id_store">store:</label>
            <input type="checkbox" name="store" id="id_store"></p>
        <button type="submit">search</button>
    </form>
</div>


<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f5318beaf9fa32376898cdd9405db0e2&libraries=services,clusterer,drawing"></script>
    <script>
        var container = document.getElementById('mapss')
        var options = {
			center: new kakao.maps.LatLng(37.4986232309429 , 127.028065727387),
			level: 3
		};

        var map = new kakao.maps.Map(container,options);
        // getElementById('id value') method는 주어진 'id value'와 일치하는 id 속성을 가진 요소를 찾아서 ,element 객체를 반환합니다.
        // 이 id는 document내에서 유일해야 하기 때문에, 특정 요소를 빠르게 찾을 때 유용합니다.
        var list_lat = document.getElementById("lat").innerText.split(','); // 해당 id를 가져오고 ,를 기준으로 문자열을 쪼개서 배열의 형태로 저장함
        var list_lng = document.getElementById("lng").innerText.split(',');
        var list_name = document.getElementById("name").innerText.split(',');

        var alcolshopsCoordinates = new Array(); // 좌표 정보를 저장할 배열을 생성

        for(var idx=0; idx<list_lat.length; idx++) { // 위도와 경도 정보를 for문을 수행하여 차례로 좌표 배열에 저장해줍니다.
            var latitude = list_lat[idx];
            var longitude = list_lng[idx];
            alcolshopsCoordinates.push(new kakao.maps.LatLng(latitude,longitude));
        }

        for(var idx=0; idx<alcolshopsCoordinates.length; idx++){ // 저장된 좌표의 수만큼, 지도에 marker를 띄워줍니다.
            var marker = new kakao.maps.Marker({
                map:map,
                position: alcolshopsCoordinates[idx],
                title : list_name[idx],
            });
            var infoWindow = new kakao.maps.InfoWindow({
                content: list_name[idx]
            });
            (function (marker, infoWindow) {
                kakao.maps.event.addListener(marker,'mouseover', function () {
                    infoWindow.open(map,marker);
                });
                kakao.maps.event.addListener(marker,'mouseout',function () {
                    infoWindow.close();
                });
            })(marker, infoWindow);
        }

        marker.setMap(map);
	</script>

</body>
</html>